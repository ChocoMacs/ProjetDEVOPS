# Utiliser l'image Alpine comme base
FROM alpine:latest

# Mettre à jour les paquets et installer les dépendances nécessaires
RUN apk update && apk add --no-cache \
    bash \
    curl \
    py3-pip \
    git \
    openssh-client \
    bash-completion \
    jq \
    docker \
    && pip install --no-cache-dir ansible \
    && curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
    && chmod +x minikube-linux-amd64 \
    && mv minikube-linux-amd64 /usr/local/bin/minikube

# Installer kubectl
RUN curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl" \
    && chmod +x kubectl \
    && mv kubectl /usr/local/bin/kubectl

# Créer le répertoire pour Ansible et copier les fichiers YAML du dépôt GitHub
WORKDIR /root
COPY . /root/

# Définir le répertoire où les fichiers YAML seront stockés
RUN mkdir -p /root/yamls

# Copier les fichiers YAML dans le répertoire approprié
COPY deploy-pods.yml /root/yamls/deploy-pods.yml

# Exposer le port 80 pour le serveur web (si nécessaire)
EXPOSE 80

# Définir le point d'entrée pour le conteneur
CMD ["sleep", "infinity"]
